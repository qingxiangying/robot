(()=>{"use strict";let t=null;const e={"Alice's House":{x:279,y:100},"Bob's House":{x:295,y:203},Cabin:{x:372,y:67},"Daria's House":{x:183,y:285},"Ernie's House":{x:50,y:283},Farm:{x:36,y:118},"Grete's House":{x:35,y:187},Marketplace:{x:162,y:110},"Post Office":{x:205,y:57},Shop:{x:137,y:212},"Town Hall":{x:202,y:213}},s=Object.keys(e);const i=function(t){let e=Object.create(null);function s(t,s){null==e[t]?e[t]=[s]:e[t].push(s)}for(let[t,e]of["Alice's House-Bob's House","Alice's House-Cabin","Alice's House-Post Office","Bob's House-Town Hall","Daria's House-Ernie's House","Daria's House-Town Hall","Ernie's House-Grete's House","Grete's House-Farm","Grete's House-Shop","Marketplace-Farm","Marketplace-Post Office","Marketplace-Shop","Marketplace-Town Hall","Shop-Town Hall"].map((t=>t.split("-"))))s(t,e),s(e,t);return e}();function o(t,e,s){let i=[{at:e,route:[]}];for(let e=0;e<i.length;e++){let{at:o,route:l}=i[e];for(let e of t[o]){if(e==s)return l.concat(e);i.some((t=>t.at==e))||i.push({at:e,route:l.concat(e)})}}}function l(t){return t[Math.floor(Math.random()*t.length)]}class r{constructor(t,e){this.place=t,this.parcels=e}move(t){if(i[this.place].includes(t)){let e=this.parcels.map((e=>e.place!=this.place?e:{place:t,address:e.address})).filter((t=>t.place!=t.address));return new r(t,e)}return this}}var n,a,h;r.random=function(t=5){let e=[];for(let s=0;s<t;s++){let t,s=l(Object.keys(i));do{t=l(Object.keys(i))}while(t==s);e.push({place:t,address:s})}return new r("Post Office",e)},n=r.random(),a=function({place:t,parcels:e},s){if(0==s.length){let l=e[0];s=l.place!=t?o(i,t,l.place):o(i,t,l.address)}return{direction:s[0],memory:s.slice(1)}},h=[],t&&null!=t.timeout&&clearTimeout(t.timeout),t=new class{constructor(t,e,s){this.worldState=t,this.robot=e,this.robotState=s,this.turn=0;let i=window.__sandbox?window.__sandbox.output.div:document.body,o=i.ownerDocument;this.node=i.appendChild(o.createElement("div")),this.node.style.cssText="position: relative; line-height: 0.1; margin-left: 10px",this.map=this.node.appendChild(o.createElement("img")),this.map.src="img/village2x.png",this.map.style.cssText="vertical-align: -8px",this.robotElt=this.node.appendChild(o.createElement("div")),this.robotElt.style.cssText="position: absolute; transition: left 0.4s, top 0.4s;",this.robotElt.appendChild(o.createElement("img")).src="img/robot_moving2x.gif",this.parcels=[],this.text=this.node.appendChild(o.createElement("span")),this.button=this.node.appendChild(o.createElement("button")),this.button.style.cssText="color: white; background: #28b; border: none; border-radius: 2px; padding: 2px 5px; line-height: 1.1; font-family: sans-serif; font-size: 80%",this.button.textContent="Stop",this.button.addEventListener("click",(()=>this.clicked())),this.schedule(),this.updateView(),this.updateParcels(),this.robotElt.addEventListener("transitionend",(()=>this.updateParcels()))}updateView(){let t=e[this.worldState.place];this.robotElt.style.top=t.y-38+"px",this.robotElt.style.left=t.x-16+"px",this.text.textContent=` Turn ${this.turn} `}updateParcels(){for(;this.parcels.length;)this.parcels.pop().remove();let t={};for(let{place:i,address:o}of this.worldState.parcels){let l=t[i]||(t[i]=0);t[i]+=14;let r=document.createElement("div"),n=16*s.indexOf(o);if(r.style.cssText="position: absolute; height: 16px; width: 16px; background-image: url(img/parcel2x.png); background-position: 0 -"+n+"px",i==this.worldState.place)r.style.left="25px",r.style.bottom=20+l+"px",this.robotElt.appendChild(r);else{let t=e[i];r.style.left=t.x-5+"px",r.style.top=t.y-10-l+"px",this.node.appendChild(r)}this.parcels.push(r)}}tick(){let{direction:t,memory:e}=this.robot(this.worldState,this.robotState);this.worldState=this.worldState.move(t),this.robotState=e,this.turn++,this.updateView(),0==this.worldState.parcels.length?(this.button.remove(),this.text.textContent=` Finished after ${this.turn} turns`,this.robotElt.firstChild.src="img/robot_idle2x.png"):this.schedule()}schedule(){this.timeout=setTimeout((()=>this.tick()),500)}clicked(){null==this.timeout?(this.schedule(),this.button.textContent="Stop",this.robotElt.firstChild.src="img/robot_moving2x.gif"):(clearTimeout(this.timeout),this.timeout=null,this.button.textContent="Start",this.robotElt.firstChild.src="img/robot_idle2x.png")}}(n,a,h)})();